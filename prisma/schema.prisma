// Kitchen Core Custom CMS Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

// User & Authentication
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String    // Hashed
  name          String?
  role          UserRole  @default(ADMIN)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

enum UserRole {
  ADMIN
  EDITOR
}

// Portfolio Projects
model Project {
  id            String    @id @default(cuid())
  title         String
  slug          String    @unique
  location      String
  category      ProjectCategory
  image         String    // Main image URL
  gallery       String[]  // Array of image URLs
  description   String
  year          String
  area          String
  budget        String
  materials     String[]
  appliances    String[]
  features      String[]
  duration      String
  challenges    String    @db.Text
  innovations   String[]
  featured      Boolean   @default(false)
  order         Int       @default(0)
  published     Boolean   @default(true)
  
  // CRM Relations
  leadId        String?   // Reference to original lead
  customerId    String?   // Reference to customer
  lead          Lead?     @relation(fields: [leadId], references: [id])
  customer      Customer? @relation(fields: [customerId], references: [id])
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([category])
  @@index([featured])
  @@index([order])
  @@index([leadId])
  @@index([customerId])
}

enum ProjectCategory {
  PALACE
  VILLA
  ESTATE
  PENTHOUSE
}

// Gallery Images
model GalleryImage {
  id            String    @id @default(cuid())
  title         String
  image         String    // Image URL
  category      ProjectCategory
  location      String
  size          GallerySize
  description   String
  order         Int       @default(0)
  published     Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([category])
  @@index([order])
}

enum GallerySize {
  SMALL
  MEDIUM
  LARGE
  WIDE
  TALL
}

// Testimonials
model Testimonial {
  id            String    @id @default(cuid())
  name          String
  title         String
  location      String
  image         String    // Client image URL
  quote         String    @db.Text
  rating        Int       @default(5)
  project       String
  featured      Boolean   @default(false)
  order         Int       @default(0)
  published     Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([featured])
  @@index([order])
}

// Process Steps
model ProcessStep {
  id            String    @id @default(cuid())
  number        String
  title         String
  description   String    @db.Text
  duration      String
  iconName      String    // Icon identifier
  order         Int       @unique
  published     Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([order])
}

// Services
model Service {
  id            String    @id @default(cuid())
  title         String
  description   String    @db.Text
  features      String[]
  order         Int       @default(0)
  published     Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([order])
}

// Statistics/Metrics
model Statistic {
  id            String    @id @default(cuid())
  number        String
  label         String
  section       StatSection
  order         Int       @default(0)
  published     Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([section])
  @@index([order])
}

enum StatSection {
  HOMEPAGE_TRUST
  GALLERY_STATS
}

// Founder Information (Singleton)
model Founder {
  id            String    @id @default(cuid())
  name          String
  title         String
  image         String    // Portrait image URL
  bio           String    @db.Text
  education     String[]
  recognition   String[]
  quote         String    @db.Text
  published     Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// Site Settings (Singleton)
model SiteSettings {
  id                String    @id @default(cuid())
  siteTitle         String
  heroTagline       String?
  heroHeading       String?
  heroSubheading    String?   @db.Text
  heroImage         String?   // Hero background image URL
  contactPhone      String?
  contactEmail      String?
  showroomAddress   String?   @db.Text
  instagramUrl      String?
  pinterestUrl      String?
  linkedinUrl       String?
  houzzUrl          String?
  partnerships      String[]  // Brand partners
  seoDescription    String?   @db.Text
  seoKeywords       String[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

// ===== NEW CMS MODELS =====

// Hero Section (Singleton) - Bilingual
model HeroSection {
  id                  String   @id @default(cuid())
  badgeEn             String
  badgeAr             String
  titleEn             String
  titleAr             String
  titleHighlightEn    String
  titleHighlightAr    String
  descriptionEn       String   @db.Text
  descriptionAr       String   @db.Text
  backgroundImage     String
  cta1TextEn          String
  cta1TextAr          String
  cta1Link            String
  cta2TextEn          String
  cta2TextAr          String
  cta2Link            String
  published           Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

// Nass Gallery Collections - Bilingual
model NassGallery {
  id                String        @id @default(cuid())
  collectionKey     String        @unique // "nass0", "nass1", "nass2", "nass3", "nass4"
  badgeEn           String
  badgeAr           String
  titleEn           String
  titleAr           String
  titleHighlightEn  String
  titleHighlightAr  String
  descriptionEn     String        @db.Text
  descriptionAr     String        @db.Text
  images            NassImage[]
  features          NassFeature[]
  order             Int           @default(0)
  published         Boolean       @default(true)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@index([collectionKey])
  @@index([order])
}

model NassImage {
  id          String      @id @default(cuid())
  gallery     NassGallery @relation(fields: [galleryId], references: [id], onDelete: Cascade)
  galleryId   String
  src         String
  alt         String
  title       String?
  size        GallerySize @default(MEDIUM)
  order       Int         @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([galleryId])
  @@index([order])
}

model NassFeature {
  id              String      @id @default(cuid())
  gallery         NassGallery @relation(fields: [galleryId], references: [id], onDelete: Cascade)
  galleryId       String
  icon            String?
  labelEn         String
  labelAr         String
  descriptionEn   String
  descriptionAr   String
  order           Int         @default(0)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@index([galleryId])
  @@index([order])
}

// Videos - Bilingual
model Video {
  id              String   @id @default(cuid())
  titleEn         String
  titleAr         String
  descriptionEn   String   @db.Text
  descriptionAr   String   @db.Text
  url             String   // Vercel Blob URL
  thumbnail       String?
  order           Int      @default(0)
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([order])
}

// Before/After Comparisons - Bilingual
model BeforeAfter {
  id              String   @id @default(cuid())
  titleEn         String
  titleAr         String
  beforeImage     String
  afterImage      String
  descriptionEn   String?  @db.Text
  descriptionAr   String?  @db.Text
  order           Int      @default(0)
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([order])
}

// Technical Specifications - Bilingual
model TechnicalSpec {
  id              String   @id @default(cuid())
  titleEn         String
  titleAr         String
  descriptionEn   String   @db.Text
  descriptionAr   String   @db.Text
  icon            String
  category        String
  order           Int      @default(0)
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([category])
  @@index([order])
}

// Innovation Features - Bilingual
model Innovation {
  id              String   @id @default(cuid())
  titleEn         String
  titleAr         String
  descriptionEn   String   @db.Text
  descriptionAr   String   @db.Text
  icon            String
  order           Int      @default(0)
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([order])
}

// Credentials/Certifications - Bilingual
model Credential {
  id              String   @id @default(cuid())
  titleEn         String
  titleAr         String
  issuer          String
  image           String?
  descriptionEn   String?  @db.Text
  descriptionAr   String?  @db.Text
  year            String?
  order           Int      @default(0)
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([order])
}

// Engineering Metrics - Bilingual
model EngineeringMetric {
  id              String   @id @default(cuid())
  number          String
  labelEn         String
  labelAr         String
  descriptionEn   String?
  descriptionAr   String?
  icon            String?
  order           Int      @default(0)
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([order])
}

// Partnerships/Brand Logos - Bilingual
model Partnership {
  id          String   @id @default(cuid())
  nameEn      String
  nameAr      String
  logo        String?
  url         String?
  order       Int      @default(0)
  published   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([order])
}

// CTA Section (Singleton) - Bilingual
model CTASection {
  id              String   @id @default(cuid())
  badgeEn         String?
  badgeAr         String?
  titleEn         String
  titleAr         String
  descriptionEn   String   @db.Text
  descriptionAr   String   @db.Text
  buttonTextEn    String
  buttonTextAr    String
  buttonLink      String
  image           String?
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Vector Embeddings for Semantic Search
model Embedding {
  id            String   @id @default(cuid())
  contentType   String   // 'project', 'service', 'gallery', 'blog', etc.
  contentId     String   // Reference to the original content ID
  title         String
  content       String   @db.Text
  embedding     Json     // Store vector as JSON array for now (upgrade to pgvector later)
  metadata      Json?    // Additional metadata for filtering
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([contentType, contentId])
  @@index([createdAt])
}

// Blog Posts for Content Marketing
model BlogPost {
  id            String   @id @default(cuid())
  slug          String   @unique
  titleEn       String
  titleAr       String?
  excerptEn     String
  excerptAr     String?
  contentEn     String   @db.Text
  contentAr     String?  @db.Text
  featuredImage String?
  category      String
  tags          String[]
  author        String   @default("Kitchen Core Team")
  readingTime   Int      // in minutes
  views         Int      @default(0)
  published     Boolean  @default(false)
  publishedAt   DateTime?
  seoTitle      String?
  seoDescription String?
  seoKeywords   String[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([slug])
  @@index([published, publishedAt])
  @@index([category])
}

// Newsletter Subscribers
model Subscriber {
  id            String   @id @default(cuid())
  email         String   @unique
  name          String?
  preferences   Json?    // Subscription preferences
  verified      Boolean  @default(false)
  verifyToken   String?
  unsubscribeToken String @unique @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([email])
  @@index([verified])
}

// Analytics Events
model AnalyticsEvent {
  id            String   @id @default(cuid())
  eventType     String   // 'page_view', 'click', 'form_submit', etc.
  eventName     String
  userId        String?  // Optional user identifier
  sessionId     String
  page          String
  metadata      Json?    // Additional event data
  userAgent     String?
  ip            String?
  country       String?
  createdAt     DateTime @default(now())

  @@index([eventType, createdAt])
  @@index([sessionId])
  @@index([userId])
}

// Company Information (Singleton) - Bilingual
model Company {
  id                    String   @id @default(cuid())
  nameEn                String
  nameAr                String
  taglineEn             String?
  taglineAr             String?
  descriptionEn         String   @db.Text
  descriptionAr         String   @db.Text
  missionEn             String?  @db.Text
  missionAr             String?  @db.Text
  visionEn              String?  @db.Text
  visionAr              String?  @db.Text
  valuesEn              String[] // Array of values
  valuesAr              String[]
  foundedYear           String?
  employeeCount         String?
  projectsCompleted     String?
  countriesServed       String?
  yearsOfExperience     String?
  featuredImage         String?  // Main about page image
  backgroundVideo       String?  // Background video URL

  // Contact & Social Media
  phone                 String?  // Main contact number
  email                 String?  // Main contact email
  whatsappNumber        String?  // WhatsApp contact number
  instagramUrl          String?  // Instagram profile URL
  facebookUrl           String?  // Facebook page URL
  linkedinUrl           String?  // LinkedIn company page
  twitterUrl            String?  // Twitter/X profile
  youtubeUrl            String?  // YouTube channel
  tiktokUrl             String?  // TikTok account

  published             Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

// Team Members - Bilingual
model TeamMember {
  id                String   @id @default(cuid())
  nameEn            String
  nameAr            String
  roleEn            String
  roleAr            String
  bioEn             String   @db.Text
  bioAr             String   @db.Text
  image             String   // Team member photo
  specialtiesEn     String[] // Areas of expertise
  specialtiesAr     String[]
  email             String?
  linkedin          String?
  yearsOfExperience String?
  order             Int      @default(0)
  published         Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([order])
}

// ===== CRM MODELS =====

// Leads - Customer inquiries and potential clients
model Lead {
  id                String      @id @default(cuid())
  firstName         String
  lastName          String
  email             String
  phone             String?
  company           String?
  jobTitle          String?
  projectType       ProjectCategory?
  budget            String?
  timeline          String?
  location          String?
  message           String      @db.Text
  source            LeadSource  @default(WEBSITE)
  status            LeadStatus  @default(NEW)
  priority          LeadPriority @default(MEDIUM)
  assignedTo        String?     // User ID
  notes             String?     @db.Text
  lastContacted     DateTime?
  nextFollowUp      DateTime?
  tags              String[]    // Custom tags for organization
  metadata          Json?       // Additional data (UTM params, etc.)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  // Relations
  interactions      LeadInteraction[]
  projects          Project[]

  @@index([email])
  @@index([status])
  @@index([source])
  @@index([assignedTo])
  @@index([createdAt])
}

enum LeadSource {
  WEBSITE
  SOCIAL_MEDIA
  REFERRAL
  ADVERTISING
  SHOWROOM
  EVENT
  PHONE
  EMAIL
  OTHER
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  PROPOSAL_SENT
  NEGOTIATING
  WON
  LOST
  ON_HOLD
}

enum LeadPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// Lead Interactions - Track all communications
model LeadInteraction {
  id            String            @id @default(cuid())
  lead          Lead              @relation(fields: [leadId], references: [id], onDelete: Cascade)
  leadId        String
  type          InteractionType
  subject       String?
  content       String            @db.Text
  direction     InteractionDirection
  outcome       InteractionOutcome?
  scheduledFor  DateTime?
  completedAt   DateTime?
  createdBy     String?           // User ID
  metadata      Json?             // Additional data
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@index([leadId])
  @@index([type])
  @@index([createdAt])
}

enum InteractionType {
  EMAIL
  PHONE_CALL
  MEETING
  SITE_VISIT
  PROPOSAL
  FOLLOW_UP
  NOTE
  OTHER
}

enum InteractionDirection {
  INBOUND
  OUTBOUND
}

enum InteractionOutcome {
  POSITIVE
  NEUTRAL
  NEGATIVE
  NO_RESPONSE
  SCHEDULED
}

// Customers - Converted leads
model Customer {
  id                String      @id @default(cuid())
  firstName         String
  lastName          String
  email             String      @unique
  phone             String?
  company           String?
  jobTitle          String?
  address           String?     @db.Text
  city              String?
  country           String?
  customerType      CustomerType @default(INDIVIDUAL)
  status            CustomerStatus @default(ACTIVE)
  source            LeadSource?
  leadId            String?     // Reference to original lead
  assignedTo        String?     // User ID
  notes             String?     @db.Text
  tags              String[]
  metadata          Json?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  // Relations
  projects          Project[]
  interactions      CustomerInteraction[]

  @@index([email])
  @@index([status])
  @@index([customerType])
  @@index([assignedTo])
}

enum CustomerType {
  INDIVIDUAL
  BUSINESS
  CORPORATE
  GOVERNMENT
}

enum CustomerStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  CLOSED
}

// Customer Interactions
model CustomerInteraction {
  id            String            @id @default(cuid())
  customer      Customer          @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerId    String
  type          InteractionType
  subject       String?
  content       String            @db.Text
  direction     InteractionDirection
  outcome       InteractionOutcome?
  scheduledFor  DateTime?
  completedAt   DateTime?
  createdBy     String?           // User ID
  metadata      Json?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@index([customerId])
  @@index([type])
  @@index([createdAt])
}

// Tasks - For follow-ups and project management
model Task {
  id            String      @id @default(cuid())
  title         String
  description   String?     @db.Text
  type          TaskType
  priority      LeadPriority
  status        TaskStatus  @default(PENDING)
  dueDate       DateTime?
  completedAt   DateTime?
  assignedTo    String?     // User ID
  relatedTo     String?     // Lead ID or Customer ID
  relatedType   String?     // 'lead' or 'customer'
  metadata      Json?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([assignedTo])
  @@index([status])
  @@index([dueDate])
  @@index([relatedTo, relatedType])
}

enum TaskType {
  FOLLOW_UP
  PROPOSAL
  SITE_VISIT
  MEETING
  CALL
  EMAIL
  DOCUMENTATION
  OTHER
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  OVERDUE
}

// Contact Form Submissions
model ContactSubmission {
  id            String      @id @default(cuid())
  name          String
  email         String
  phone         String?
  company       String?
  subject       String?
  message       String      @db.Text
  source        String?     // Page URL or referrer
  metadata      Json?       // UTM params, user agent, etc.
  processed     Boolean     @default(false)
  processedBy   String?     // User ID
  processedAt   DateTime?
  notes         String?     @db.Text
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([email])
  @@index([processed])
  @@index([createdAt])
}
